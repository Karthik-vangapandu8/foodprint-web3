<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
    <link rel="stylesheet" href="/src/css/voice-input.css">
    <title>‡§´‡§∏‡§≤ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç | Add Harvest - FoodPrint</title>
</head>
<body>
    <%- include('partials/header') %>

    <div class="container mt-5">
        <div class="simple-form-container">
            <!-- Header -->
            <div class="text-center mb-4">
                <h1 class="mb-2">
                    <span style="font-size: 32px;">üåæ</span>
                    <span style="font-size: 24px; font-weight: 700;">‡§´‡§∏‡§≤ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</span>
                </h1>
                <p style="font-size: 18px; color: #666;">Add Harvest</p>
            </div>

            <!-- Step Indicator -->
            <div class="step-indicator">
                <p>‡§ö‡§∞‡§£ <span id="currentStep">1</span> ‡§ï‡§æ 5</p>
                <p style="font-size: 12px;">Step <span id="currentStepEn">1</span> of 5</p>
                <div class="step-dots">
                    <div class="step-dot active" data-step="1"></div>
                    <div class="step-dot" data-step="2"></div>
                    <div class="step-dot" data-step="3"></div>
                    <div class="step-dot" data-step="4"></div>
                    <div class="step-dot" data-step="5"></div>
                </div>
            </div>

            <form id="harvestForm">
                <!-- Step 1: Crop Type -->
                <div class="form-step active" data-step="1">
                    <div class="voice-instruction">
                        <span class="voice-instruction-icon">üé§</span>
                        <div class="voice-instruction-text">
                            <div class="voice-instruction-primary">‡§Ü‡§™ ‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡•ã‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç</div>
                            <div class="voice-instruction-secondary">You can speak the crop name</div>
                        </div>
                    </div>

                    <button type="button" class="btn-large btn-voice" onclick="listenForCrop()">
                        üé§ ‡§¨‡•ã‡§≤‡•á‡§Ç | Speak
                    </button>

                    <p style="text-align: center; color: #999; margin: 20px 0;">‡§Ø‡§æ ‡§®‡•Ä‡§ö‡•á ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç (Or choose below)</p>

                    <div class="icon-grid">
                        <div class="icon-card" onclick="selectCrop('Tomato', 'üçÖ', '‡§ü‡§Æ‡§æ‡§ü‡§∞', this)">
                            <div class="checkmark">‚úì</div>
                            <div class="icon">üçÖ</div>
                            <div class="label-primary">‡§ü‡§Æ‡§æ‡§ü‡§∞</div>
                            <div class="label-secondary">Tomato</div>
                        </div>

                        <div class="icon-card" onclick="selectCrop('Potato', 'ü•î', '‡§Ü‡§≤‡•Ç', this)">
                            <div class="checkmark">‚úì</div>
                            <div class="icon">ü•î</div>
                            <div class="label-primary">‡§Ü‡§≤‡•Ç</div>
                            <div class="label-secondary">Potato</div>
                        </div>

                        <div class="icon-card" onclick="selectCrop('Wheat', 'üåæ', '‡§ó‡•á‡§π‡•Ç‡§Ç', this)">
                            <div class="checkmark">‚úì</div>
                            <div class="icon">üåæ</div>
                            <div class="label-primary">‡§ó‡•á‡§π‡•Ç‡§Ç</div>
                            <div class="label-secondary">Wheat</div>
                        </div>

                        <div class="icon-card" onclick="selectCrop('Brinjal', 'üçÜ', '‡§¨‡•à‡§Ç‡§ó‡§®', this)">
                            <div class="checkmark">‚úì</div>
                            <div class="icon">üçÜ</div>
                            <div class="label-primary">‡§¨‡•à‡§Ç‡§ó‡§®</div>
                            <div class="label-secondary">Brinjal</div>
                        </div>

                        <div class="icon-card" onclick="selectCrop('Carrot', 'ü•ï', '‡§ó‡§æ‡§ú‡§∞', this)">
                            <div class="checkmark">‚úì</div>
                            <div class="icon">ü•ï</div>
                            <div class="label-primary">‡§ó‡§æ‡§ú‡§∞</div>
                            <div class="label-secondary">Carrot</div>
                        </div>

                        <div class="icon-card" onclick="selectCrop('Onion', 'üßÖ', '‡§™‡•ç‡§Ø‡§æ‡§ú', this)">
                            <div class="checkmark">‚úì</div>
                            <div class="icon">üßÖ</div>
                            <div class="label-primary">‡§™‡•ç‡§Ø‡§æ‡§ú</div>
                            <div class="label-secondary">Onion</div>
                        </div>
                    </div>

                    <input type="hidden" id="cropName" name="cropName">

                    <div class="action-buttons">
                        <button type="button" class="btn-large btn-primary" onclick="nextStep()" id="step1Next" disabled>
                            ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç | Next ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Step 2: Quantity -->
                <div class="form-step" data-step="2">
                    <div class="voice-instruction">
                        <span class="voice-instruction-icon">üé§</span>
                        <div class="voice-instruction-text">
                            <div class="voice-instruction-primary">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§¨‡•ã‡§≤‡•á‡§Ç</div>
                            <div class="voice-instruction-secondary">Speak the quantity</div>
                        </div>
                    </div>

                    <button type="button" class="btn-large btn-voice" onclick="listenForQuantity()">
                        üé§ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ ‡§¨‡•ã‡§≤‡•á‡§Ç | Speak Quantity
                    </button>

                    <div class="form-group">
                        <label class="form-label-bilingual">
                            <span class="form-label-primary">‡§ï‡§ø‡§§‡§®‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ?</span>
                            <span class="form-label-secondary">How much quantity?</span>
                        </label>
                        <input type="text" class="large-input" id="quantity" name="quantity" 
                               placeholder="‡§ú‡•à‡§∏‡•á: 100 ‡§Ø‡§æ ‡§¨‡•ã‡§≤‡•á‡§Ç">
                    </div>

                    <div class="form-group">
                        <label class="form-label-bilingual">
                            <span class="form-label-primary">‡§á‡§ï‡§æ‡§à ‡§ö‡•Å‡§®‡•á‡§Ç</span>
                            <span class="form-label-secondary">Select Unit</span>
                        </label>
                        <div class="icon-grid">
                            <div class="icon-card" onclick="selectUnit('kg', '‡§ï‡§ø‡§≤‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ', this)">
                                <div class="checkmark">‚úì</div>
                                <div class="icon">‚öñÔ∏è</div>
                                <div class="label-primary">‡§ï‡§ø‡§≤‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ</div>
                                <div class="label-secondary">Kilogram (kg)</div>
                            </div>
                            <div class="icon-card" onclick="selectUnit('quintal', '‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤', this)">
                                <div class="checkmark">‚úì</div>
                                <div class="icon">üì¶</div>
                                <div class="label-primary">‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤</div>
                                <div class="label-secondary">Quintal</div>
                            </div>
                            <div class="icon-card" onclick="selectUnit('ton', '‡§ü‡§®', this)">
                                <div class="checkmark">‚úì</div>
                                <div class="icon">üöõ</div>
                                <div class="label-primary">‡§ü‡§®</div>
                                <div class="label-secondary">Ton</div>
                            </div>
                        </div>
                        <input type="hidden" id="unit" name="unit">
                    </div>

                    <div class="action-buttons">
                        <button type="button" class="btn-large btn-secondary" onclick="prevStep()">
                            ‚Üê ‡§™‡•Ä‡§õ‡•á | Back
                        </button>
                        <button type="button" class="btn-large btn-primary" onclick="nextStep()" id="step2Next" disabled>
                            ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç | Next ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Step 3: Photo -->
                <div class="form-step" data-step="3">
                    <div class="voice-instruction">
                        <span class="voice-instruction-icon">üì∏</span>
                        <div class="voice-instruction-text">
                            <div class="voice-instruction-primary">‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç</div>
                            <div class="voice-instruction-secondary">Take a photo of the harvest</div>
                        </div>
                    </div>

                    <div class="form-group text-center">
                        <div id="photoPreview" style="margin: 20px 0; min-height: 200px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <p style="color: #999;">üì∏ ‡§´‡•ã‡§ü‡•ã ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä</p>
                        </div>
                        
                        <label for="harvestPhoto" class="btn-large btn-primary" style="cursor: pointer;">
                            üì∑ ‡§´‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç | Take Photo
                        </label>
                        <input type="file" id="harvestPhoto" name="harvestPhoto" accept="image/*" capture="environment" style="display: none;" onchange="previewPhoto(this)">
                        
                        <p style="margin-top: 15px; color: #666;">
                            (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï - ‡§Ü‡§™ ‡§õ‡•ã‡§°‡§º ‡§≠‡•Ä ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)<br>
                            <small>(Optional - you can skip)</small>
                        </p>
                    </div>

                    <div class="action-buttons">
                        <button type="button" class="btn-large btn-secondary" onclick="prevStep()">
                            ‚Üê ‡§™‡•Ä‡§õ‡•á | Back
                        </button>
                        <button type="button" class="btn-large btn-primary" onclick="nextStep()">
                            ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç | Next ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Step 4: Location -->
                <div class="form-step" data-step="4">
                    <div class="voice-instruction">
                        <span class="voice-instruction-icon">üìç</span>
                        <div class="voice-instruction-text">
                            <div class="voice-instruction-primary">‡§Ü‡§™‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø</div>
                            <div class="voice-instruction-secondary">Your location</div>
                        </div>
                    </div>

                    <button type="button" class="btn-large btn-voice" onclick="getCurrentLocation()">
                        üìç ‡§Ö‡§™‡§®‡•Ä ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç | Use My Location
                    </button>

                    <div class="form-group">
                        <div id="locationPreview" style="padding: 20px; background: #e8f5e9; border-radius: 8px; text-align: center; margin: 20px 0;">
                            <p style="font-size: 16px; font-weight: 600;">üåç Location will appear here</p>
                        </div>
                        <input type="hidden" id="latitude" name="latitude">
                        <input type="hidden" id="longitude" name="longitude">
                    </div>

                    <div class="action-buttons">
                        <button type="button" class="btn-large btn-secondary" onclick="prevStep()">
                            ‚Üê ‡§™‡•Ä‡§õ‡•á | Back
                        </button>
                        <button type="button" class="btn-large btn-primary" onclick="nextStep()" id="step4Next" disabled>
                            ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç | Next ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Step 5: Confirm -->
                <div class="form-step" data-step="5">
                    <h3 style="text-align: center; margin-bottom: 30px;">
                        <span style="font-size: 28px;">‚úÖ</span><br>
                        ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç | Confirm
                    </h3>

                    <div id="summaryContent" style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <!-- Summary will be populated by JS -->
                    </div>

                    <div class="action-buttons">
                        <button type="button" class="btn-large btn-secondary" onclick="prevStep()">
                            ‚Üê ‡§™‡•Ä‡§õ‡•á | Back
                        </button>
                        <button type="submit" class="btn-large btn-primary">
                            ‚úÖ ‡§∏‡§π‡•á‡§ú‡•á‡§Ç | Save Harvest
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <%- include('partials/scripts') %>
    <script src="/src/js/voice-input.js"></script>
    
    <script>
        let currentStep = 1;
        const totalSteps = 5;
        const formData = {};

        // Voice recognition for crop
        function listenForCrop() {
            const cropMap = {
                '‡§ü‡§Æ‡§æ‡§ü‡§∞': 'Tomato',
                'tomato': 'Tomato',
                '‡§Ü‡§≤‡•Ç': 'Potato',
                'potato': 'Potato',
                '‡§ó‡•á‡§π‡•Ç‡§Ç': 'Wheat',
                'wheat': 'Wheat',
                '‡§¨‡•à‡§Ç‡§ó‡§®': 'Brinjal',
                'brinjal': 'Brinjal',
                '‡§ó‡§æ‡§ú‡§∞': 'Carrot',
                'carrot': 'Carrot',
                '‡§™‡•ç‡§Ø‡§æ‡§ú': 'Onion',
                'onion': 'Onion'
            };

            if (window.VoiceInputManager && window.VoiceInputManager.isSupported) {
                const recognition = window.VoiceInputManager.recognition;
                recognition.lang = 'hi-IN';
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript.toLowerCase();
                    
                    // Find matching crop
                    for (let [key, value] of Object.entries(cropMap)) {
                        if (transcript.includes(key.toLowerCase())) {
                            selectCropByName(value);
                            window.VoiceInputManager.speakText(`‡§Ü‡§™‡§®‡•á ‡§ö‡•Å‡§®‡§æ: ${key}`);
                            break;
                        }
                    }
                };
                
                recognition.start();
            } else {
                alert('‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡•Ä‡§ö‡•á ‡§∏‡•á ‡§ö‡•Å‡§®‡•á‡§Ç‡•§');
            }
        }

        function selectCrop(cropName, icon, hindiName, element) {
            // Remove previous selections
            document.querySelectorAll('.icon-card').forEach(card => card.classList.remove('selected'));
            
            // Select this card
            element.classList.add('selected');
            
            // Store data
            document.getElementById('cropName').value = cropName;
            formData.cropName = cropName;
            formData.cropIcon = icon;
            formData.cropHindi = hindiName;
            
            // Enable next button
            document.getElementById('step1Next').disabled = false;
            
            // Speak confirmation
            if (window.VoiceInputManager) {
                window.VoiceInputManager.speakText(`‡§Ü‡§™‡§®‡•á ${hindiName} ‡§ö‡•Å‡§®‡§æ`);
            }
        }

        function selectCropByName(cropName) {
            const cardMap = {
                'Tomato': 0,
                'Potato': 1,
                'Wheat': 2,
                'Brinjal': 3,
                'Carrot': 4,
                'Onion': 5
            };
            
            const cards = document.querySelectorAll('.icon-card');
            const index = cardMap[cropName];
            if (index !== undefined && cards[index]) {
                cards[index].click();
            }
        }

        function listenForQuantity() {
            if (window.VoiceInputManager && window.VoiceInputManager.isSupported) {
                const recognition = window.VoiceInputManager.recognition;
                recognition.lang = 'hi-IN';
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    // Extract number from speech
                    const numbers = transcript.match(/\d+/);
                    if (numbers) {
                        document.getElementById('quantity').value = numbers[0];
                        formData.quantity = numbers[0];
                        checkStep2Complete();
                        window.VoiceInputManager.speakText(`‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ: ${numbers[0]}`);
                    }
                };
                
                recognition.start();
            }
        }

        function selectUnit(unit, hindiUnit, element) {
            document.querySelectorAll('[data-step="2"] .icon-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            
            document.getElementById('unit').value = unit;
            formData.unit = unit;
            formData.unitHindi = hindiUnit;
            
            checkStep2Complete();
            
            if (window.VoiceInputManager) {
                window.VoiceInputManager.speakText(`‡§á‡§ï‡§æ‡§à: ${hindiUnit}`);
            }
        }

        function checkStep2Complete() {
            const quantity = document.getElementById('quantity').value;
            const unit = document.getElementById('unit').value;
            document.getElementById('step2Next').disabled = !(quantity && unit);
        }

        function previewPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoPreview').innerHTML = 
                        `<img src="${e.target.result}" style="max-width: 100%; max-height: 300px; border-radius: 8px;">`;
                    formData.hasPhoto = true;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                document.getElementById('locationPreview').innerHTML = 
                    `<p style="color: #4CAF50;">‚è≥ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</p>`;
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude.toFixed(6);
                        const lon = position.coords.longitude.toFixed(6);
                        
                        document.getElementById('latitude').value = lat;
                        document.getElementById('longitude').value = lon;
                        formData.latitude = lat;
                        formData.longitude = lon;
                        
                        document.getElementById('locationPreview').innerHTML = 
                            `<p style="color: #4CAF50; font-weight: 600;">‚úÖ ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§Æ‡§ø‡§≤ ‡§ó‡§à!</p>
                             <p>üìç ${lat}, ${lon}</p>`;
                        
                        document.getElementById('step4Next').disabled = false;
                        
                        if (window.VoiceInputManager) {
                            window.VoiceInputManager.speakText('‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§Æ‡§ø‡§≤ ‡§ó‡§à');
                        }
                    },
                    (error) => {
                        document.getElementById('locationPreview').innerHTML = 
                            `<p style="color: #f44336;">‚ùå ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä</p>`;
                        console.error('Location error:', error);
                    }
                );
            } else {
                alert('‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à');
            }
        }

        function nextStep() {
            if (currentStep === 5) return;
            
            // Update step dots
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.add('completed');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.remove('active');
            
            // Hide current step
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
            
            // Show next step
            currentStep++;
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.add('active');
            
            // Update indicators
            document.getElementById('currentStep').textContent = currentStep;
            document.getElementById('currentStepEn').textContent = currentStep;
            
            // Show summary on last step
            if (currentStep === 5) {
                showSummary();
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function prevStep() {
            if (currentStep === 1) return;
            
            // Update step dots
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.remove('active');
            
            // Hide current step
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
            
            // Show previous step
            currentStep--;
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.remove('completed');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.add('active');
            
            // Update indicators
            document.getElementById('currentStep').textContent = currentStep;
            document.getElementById('currentStepEn').textContent = currentStep;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showSummary() {
            const summary = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: white; border-radius: 8px;">
                        <span style="font-size: 40px;">${formData.cropIcon}</span>
                        <div>
                            <div style="font-size: 20px; font-weight: 700;">${formData.cropHindi}</div>
                            <div style="color: #666;">${formData.cropName}</div>
                        </div>
                    </div>
                    <div style="padding: 15px; background: white; border-radius: 8px;">
                        <div style="font-weight: 700;">‚öñÔ∏è ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ | Quantity:</div>
                        <div style="font-size: 18px; margin-top: 5px;">${formData.quantity} ${formData.unitHindi || formData.unit}</div>
                    </div>
                    ${formData.hasPhoto ? `
                    <div style="padding: 15px; background: white; border-radius: 8px;">
                        <div style="font-weight: 700;">üì∏ ‡§´‡•ã‡§ü‡•ã | Photo:</div>
                        <div style="margin-top: 5px;">‚úÖ Uploaded</div>
                    </div>
                    ` : ''}
                    ${formData.latitude ? `
                    <div style="padding: 15px; background: white; border-radius: 8px;">
                        <div style="font-weight: 700;">üìç ‡§∏‡•ç‡§•‡§æ‡§® | Location:</div>
                        <div style="font-size: 14px; margin-top: 5px;">${formData.latitude}, ${formData.longitude}</div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('summaryContent').innerHTML = summary;
            
            // Speak summary
            if (window.VoiceInputManager) {
                window.VoiceInputManager.speakText(
                    `${formData.cropHindi}, ${formData.quantity} ${formData.unitHindi}. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç‡•§`
                );
            }
        }

        // Form submission
        document.getElementById('harvestForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Show loading
            alert('‡§´‡§∏‡§≤ ‡§∏‡§π‡•á‡§ú ‡§∞‡§π‡•á ‡§π‡•à‡§Ç... | Saving harvest...');
            
            // TODO: Submit to backend
            console.log('Form data:', formData);
            
            // Success message
            setTimeout(() => {
                if (window.VoiceInputManager) {
                    window.VoiceInputManager.speakText('‡§´‡§∏‡§≤ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡•Ä ‡§ó‡§à');
                }
                alert('‚úÖ ‡§´‡§∏‡§≤ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡•Ä ‡§ó‡§à! | Harvest saved successfully!');
                window.location.href = '/app/harvest';
            }, 1000);
        });

        // Enable voice on page load
        if (window.VoiceInputManager && window.VoiceInputManager.isSupported) {
            console.log('üé§ Voice input available!');
            
            // Give audio instructions
            setTimeout(() => {
                window.VoiceInputManager.speakText('‡§®‡§Æ‡§∏‡•ç‡§§‡•á‡•§ ‡§Ö‡§™‡§®‡•Ä ‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§');
            }, 1000);
        }

        // Listen for quantity input
        document.getElementById('quantity').addEventListener('input', checkStep2Complete);
    </script>

    <%- include('partials/footer') %>
</body>
</html>

