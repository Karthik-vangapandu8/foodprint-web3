<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
    <title>üõí Marketplace - FoodPrint</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .marketplace-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        .header-title {
            font-size: 32px;
            font-weight: 800;
        }
        .header-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-top: 5px;
        }
        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }
        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .voice-search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .voice-search-btn:hover {
            background: #5568d3;
            transform: translateY(-50%) scale(1.1);
        }
        .filters-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        .filter-chip {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filter-chip:hover, .filter-chip.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .products-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }
        .product-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            position: relative;
        }
        .quality-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4CAF50;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        .blockchain-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(102,126,234,0.5); }
            50% { box-shadow: 0 0 15px rgba(102,126,234,0.8); }
        }
        .product-info {
            padding: 20px;
        }
        .product-name {
            font-size: 22px;
            font-weight: 800;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .product-name-hindi {
            font-size: 16px;
            color: #666;
            margin-bottom: 12px;
        }
        .product-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        .detail-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #555;
        }
        .detail-icon {
            font-size: 18px;
        }
        .price-row {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin: 15px 0;
        }
        .price {
            font-size: 28px;
            font-weight: 800;
            color: #667eea;
        }
        .price-unit {
            font-size: 14px;
            color: #666;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn-whatsapp {
            flex: 1;
            padding: 12px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .btn-whatsapp:hover {
            background: #20ba5a;
            transform: scale(1.05);
        }
        .btn-call {
            padding: 12px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-call:hover {
            background: #1976D2;
            transform: scale(1.05);
        }
        .farmer-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            margin-top: 15px;
        }
        .farmer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
        }
        .farmer-details {
            flex: 1;
        }
        .farmer-name {
            font-weight: 700;
            color: #333;
            font-size: 14px;
        }
        .farmer-location {
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #999;
        }
        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        .floating-chat {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1000;
        }
        .floating-chat:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.6);
        }
        @media (max-width: 768px) {
            .products-container {
                grid-template-columns: 1fr;
            }
            .header-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <%- include('partials/header') %>

    <!-- Marketplace Header -->
    <div class="marketplace-header">
        <div class="header-content">
            <div>
                <h1 class="header-title">üõí ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç | Buy Fresh Produce</h1>
                <p class="header-subtitle">‡§ï‡§ø‡§∏‡§æ‡§® ‡§∏‡•á ‡§∏‡•Ä‡§ß‡•á ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç ‚Ä¢ Buy directly from farmers</p>
            </div>
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="‡§ü‡§Æ‡§æ‡§ü‡§∞, ‡§Ü‡§≤‡•Ç, ‡§ó‡•á‡§π‡•Ç‡§Ç... | Search crops" id="searchInput">
                <button class="voice-search-btn" onclick="voiceSearch()">üé§</button>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-container">
        <div class="filter-chip active" data-filter="all">
            üåæ ‡§∏‡§≠‡•Ä | All
        </div>
        <div class="filter-chip" data-filter="vegetables">
            ü•ï ‡§∏‡§¨‡•ç‡§ú‡§º‡§ø‡§Ø‡§æ‡§Å | Vegetables
        </div>
        <div class="filter-chip" data-filter="fruits">
            üçé ‡§´‡§≤ | Fruits
        </div>
        <div class="filter-chip" data-filter="grains">
            üåæ ‡§Ö‡§®‡§æ‡§ú | Grains
        </div>
        <div class="filter-chip" data-filter="organic">
            ‚úÖ ‡§ú‡•à‡§µ‡§ø‡§ï | Organic
        </div>
        <div class="filter-chip" data-filter="nearby">
            üìç ‡§®‡§ú‡§º‡§¶‡•Ä‡§ï | Nearby
        </div>
        <div class="filter-chip" data-filter="fresh">
            üÜï ‡§§‡§æ‡§ú‡§º‡§æ | Fresh Today
        </div>
    </div>

    <!-- Products Grid -->
    <div class="products-container" id="productsContainer">
        <!-- Sample Product Card 1 - With Blockchain -->
        <div class="product-card" data-category="vegetables" data-blockchain-hash="0xabc123...">
            <div class="product-image">
                üçÖ
                <span class="blockchain-badge">
                    <span>‚õìÔ∏è</span>
                    <span>Blockchain</span>
                </span>
                <span class="quality-badge">‚úÖ ‡§ú‡•à‡§µ‡§ø‡§ï</span>
            </div>
            <div class="product-info">
                <div class="product-name">
                    Tomato
                    <span style="font-size: 16px;">üî• Fresh</span>
                </div>
                <div class="product-name-hindi">‡§ü‡§Æ‡§æ‡§ü‡§∞</div>
                
                <div class="product-details">
                    <div class="detail-row">
                        <span class="detail-icon">üì¶</span>
                        <span><strong>100 kg</strong> ‡§â‡§™‡§≤‡§¨‡•ç‡§ß</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-icon">üìç</span>
                        <span>5 km away ‚Ä¢ Pune</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-icon">‚úÖ</span>
                        <span>Pesticide Free</span>
                    </div>
                    <div class="detail-row" style="color: #667eea; font-weight: 600;">
                        <span class="detail-icon">‚õìÔ∏è</span>
                        <span>Blockchain Verified</span>
                    </div>
                </div>

                <div class="price-row">
                    <span class="price">‚Çπ40</span>
                    <span class="price-unit">/ kg</span>
                </div>

                <!-- Blockchain Actions -->
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <button onclick="showBlockchainInfo('0xabc123...')" style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 10px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px;">
                        <span>‚õìÔ∏è</span>
                        <span>Track Journey</span>
                    </button>
                    <button onclick="scanQRCode()" style="padding: 10px 15px; background: #ff9800; color: white; border: none; border-radius: 10px; font-size: 20px; cursor: pointer;">
                        üì±
                    </button>
                </div>

                <div class="action-buttons">
                    <button class="btn-whatsapp" onclick="contactFarmer('9876543210', 'Tomato')">
                        <span>üí¨</span>
                        <span>WhatsApp</span>
                    </button>
                    <button class="btn-call" onclick="callFarmer('9876543210')">
                        üìû
                    </button>
                </div>

                <div class="farmer-info">
                    <div class="farmer-avatar">RS</div>
                    <div class="farmer-details">
                        <div class="farmer-name">Ramesh Sharma</div>
                        <div class="farmer-location">
                            <span>üåæ</span>
                            <span>Verified Farmer</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Product Card 2 -->
        <div class="product-card" data-category="vegetables">
            <div class="product-image">
                ü•î
            </div>
            <div class="product-info">
                <div class="product-name">Potato</div>
                <div class="product-name-hindi">‡§Ü‡§≤‡•Ç</div>
                
                <div class="product-details">
                    <div class="detail-row">
                        <span class="detail-icon">üì¶</span>
                        <span><strong>200 kg</strong> ‡§â‡§™‡§≤‡§¨‡•ç‡§ß</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-icon">üìç</span>
                        <span>12 km away ‚Ä¢ Mumbai</span>
                    </div>
                </div>

                <div class="price-row">
                    <span class="price">‚Çπ30</span>
                    <span class="price-unit">/ kg</span>
                </div>

                <div class="action-buttons">
                    <button class="btn-whatsapp" onclick="contactFarmer('9876543211', 'Potato')">
                        <span>üí¨</span>
                        <span>WhatsApp</span>
                    </button>
                    <button class="btn-call" onclick="callFarmer('9876543211')">
                        üìû
                    </button>
                </div>

                <div class="farmer-info">
                    <div class="farmer-avatar">SK</div>
                    <div class="farmer-details">
                        <div class="farmer-name">Suresh Kumar</div>
                        <div class="farmer-location">
                            <span>üåæ</span>
                            <span>Verified Farmer</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Product Card 3 -->
        <div class="product-card" data-category="grains">
            <div class="product-image">
                üåæ
                <span class="quality-badge">‚úÖ ‡§ú‡•à‡§µ‡§ø‡§ï</span>
            </div>
            <div class="product-info">
                <div class="product-name">
                    Wheat
                    <span style="font-size: 14px; background: #ff9800; color: white; padding: 4px 8px; border-radius: 8px;">üî• HOT</span>
                </div>
                <div class="product-name-hindi">‡§ó‡•á‡§π‡•Ç‡§Ç</div>
                
                <div class="product-details">
                    <div class="detail-row">
                        <span class="detail-icon">üì¶</span>
                        <span><strong>5 quintal</strong> ‡§â‡§™‡§≤‡§¨‡•ç‡§ß</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-icon">üìç</span>
                        <span>8 km away ‚Ä¢ Delhi</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-icon">‚úÖ</span>
                        <span>100% Organic</span>
                    </div>
                </div>

                <div class="price-row">
                    <span class="price">‚Çπ2,500</span>
                    <span class="price-unit">/ quintal</span>
                </div>

                <div class="action-buttons">
                    <button class="btn-whatsapp" onclick="contactFarmer('9876543212', 'Wheat')">
                        <span>üí¨</span>
                        <span>WhatsApp</span>
                    </button>
                    <button class="btn-call" onclick="callFarmer('9876543212')">
                        üìû
                    </button>
                </div>

                <div class="farmer-info">
                    <div class="farmer-avatar">AP</div>
                    <div class="farmer-details">
                        <div class="farmer-name">Anil Patel</div>
                        <div class="farmer-location">
                            <span>‚≠ê</span>
                            <span>Top Seller</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div style="position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 15px; z-index: 1000;">
        <!-- Scan QR Code Button -->
        <div class="floating-chat" onclick="openQRScanner()" title="QR ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç | Scan QR Code" style="background: #ff9800;">
            üì±
        </div>
        <!-- WhatsApp Support -->
        <div class="floating-chat" onclick="openWhatsAppSupport()" title="‡§π‡§Æ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç | Chat with us">
            üí¨
        </div>
    </div>

    <!-- Blockchain Info Modal -->
    <div id="blockchainModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="font-size: 28px; font-weight: 800; color: #333; margin: 0;">
                    ‚õìÔ∏è Blockchain Journey
                </h2>
                <button onclick="closeBlockchainModal()" style="background: none; border: none; font-size: 30px; cursor: pointer; color: #999;">√ó</button>
            </div>

            <!-- Product Journey Timeline -->
            <div id="journeyTimeline">
                <div style="position: relative; padding-left: 40px;">
                    <!-- Step 1: Harvest -->
                    <div style="position: relative; margin-bottom: 30px;">
                        <div style="position: absolute; left: -40px; width: 30px; height: 30px; background: #4CAF50; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">1</div>
                        <div style="position: absolute; left: -25px; top: 30px; bottom: -30px; width: 2px; background: #e0e0e0;"></div>
                        <div style="background: #f5f5f5; padding: 20px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üåæ</div>
                            <div style="font-weight: 700; font-size: 18px; margin-bottom: 8px;">Harvested</div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">üìÖ 15 Jan 2026, 10:30 AM</div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">üë®‚Äçüåæ Ramesh Sharma</div>
                            <div style="color: #666; font-size: 14px;">üìç Pune, Maharashtra</div>
                            <div style="margin-top: 10px; padding: 8px; background: #e8f5e9; border-radius: 8px; font-size: 12px; color: #2e7d32; word-break: break-all;">
                                <strong>Hash:</strong> 0xabc123...def456
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Storage -->
                    <div style="position: relative; margin-bottom: 30px;">
                        <div style="position: absolute; left: -40px; width: 30px; height: 30px; background: #2196F3; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">2</div>
                        <div style="position: absolute; left: -25px; top: 30px; bottom: -30px; width: 2px; background: #e0e0e0;"></div>
                        <div style="background: #f5f5f5; padding: 20px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üè≠</div>
                            <div style="font-weight: 700; font-size: 18px; margin-bottom: 8px;">Cold Storage</div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">üìÖ 15 Jan 2026, 2:00 PM</div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">üå°Ô∏è Temperature: 4¬∞C</div>
                            <div style="color: #666; font-size: 14px;">‚è±Ô∏è Duration: 6 hours</div>
                            <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 8px; font-size: 12px; color: #1565c0; word-break: break-all;">
                                <strong>Hash:</strong> 0xdef456...ghi789
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Ready for Sale -->
                    <div style="position: relative;">
                        <div style="position: absolute; left: -40px; width: 30px; height: 30px; background: #ff9800; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">3</div>
                        <div style="background: #f5f5f5; padding: 20px; border-radius: 12px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üõí</div>
                            <div style="font-weight: 700; font-size: 18px; margin-bottom: 8px;">Ready for Sale</div>
                            <div style="color: #666; font-size: 14px; margin-bottom: 5px;">üìÖ 16 Jan 2026, 8:00 AM</div>
                            <div style="color: #666; font-size: 14px;">‚úÖ Quality Checked</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QR Code -->
            <div style="margin-top: 30px; text-align: center; padding: 20px; background: #f5f5f5; border-radius: 12px;">
                <div style="font-weight: 700; margin-bottom: 15px;">üì± Scan to Verify</div>
                <div style="width: 150px; height: 150px; background: white; margin: 0 auto; display: flex; align-items: center; justify-content: center; border-radius: 12px; font-size: 80px;">
                    üì±
                </div>
                <div style="margin-top: 15px; font-size: 12px; color: #666;">
                    Scan this QR code to verify product authenticity
                </div>
            </div>

            <!-- Blockchain Verification -->
            <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%); border-radius: 12px; text-align: center;">
                <div style="font-weight: 700; color: #667eea; margin-bottom: 5px;">‚úÖ Verified on Blockchain</div>
                <div style="font-size: 12px; color: #666;">This product journey is immutable and transparent</div>
            </div>
        </div>
    </div>

    <!-- QR Scanner Modal -->
    <div id="qrScannerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center; flex-direction: column; padding: 20px;">
        <div style="text-align: center; color: white; margin-bottom: 30px;">
            <h2 style="font-size: 32px; margin-bottom: 10px;">üì± QR Scanner</h2>
            <p style="font-size: 18px; opacity: 0.9;">QR ‡§ï‡•ã‡§° ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç | Scan QR Code</p>
        </div>
        
        <div style="width: 300px; height: 300px; border: 4px solid white; border-radius: 20px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;">
            <div style="font-size: 80px;">üì∑</div>
            <!-- Scanning animation -->
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: #4CAF50; animation: scan 2s linear infinite;"></div>
        </div>

        <div style="margin-top: 30px; text-align: center;">
            <p style="color: white; font-size: 16px; margin-bottom: 20px;">
                üé§ ‡§Ø‡§æ ‡§¨‡•ã‡§≤‡§ï‡§∞ ‡§∏‡§∞‡•ç‡§ö ‡§ï‡§∞‡•á‡§Ç<br>
                <small style="opacity: 0.8;">Or speak to search product</small>
            </p>
            <button onclick="closeQRScanner()" style="padding: 15px 40px; background: white; color: #333; border: none; border-radius: 50px; font-size: 18px; font-weight: 700; cursor: pointer;">
                Close
            </button>
        </div>
    </div>

    <style>
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
    </style>

    <%- include('partials/scripts') %>
    
    <script>
        // Filter functionality
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', function() {
                // Remove active from all
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                // Add active to clicked
                this.classList.add('active');
                
                const filter = this.dataset.filter;
                filterProducts(filter);
            });
        });

        function filterProducts(category) {
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                if (category === 'all') {
                    card.style.display = 'block';
                } else {
                    if (card.dataset.category === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            
            cards.forEach(card => {
                const name = card.querySelector('.product-name').textContent.toLowerCase();
                const nameHindi = card.querySelector('.product-name-hindi').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || nameHindi.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Voice search
        function voiceSearch() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('Voice search not supported in this browser. Please use Chrome or Edge.');
                return;
            }

            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'hi-IN';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('searchInput').value = transcript;
                
                // Trigger search
                const inputEvent = new Event('input', { bubbles: true });
                document.getElementById('searchInput').dispatchEvent(inputEvent);
            };

            recognition.start();
            
            // Visual feedback
            const btn = document.querySelector('.voice-search-btn');
            btn.style.background = '#f44336';
            setTimeout(() => {
                btn.style.background = '#667eea';
            }, 3000);
        }

        // Contact farmer via WhatsApp
        function contactFarmer(phone, productName) {
            const message = encodeURIComponent(`‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•Å‡§ù‡•á ${productName} ‡§ñ‡§∞‡•Ä‡§¶‡§®‡§æ ‡§π‡•à‡•§ | Hello! I want to buy ${productName}.`);
            const url = `https://wa.me/91${phone}?text=${message}`;
            window.open(url, '_blank');
        }

        // Call farmer
        function callFarmer(phone) {
            window.location.href = `tel:+91${phone}`;
        }

        // Open WhatsApp support
        function openWhatsAppSupport() {
            const message = encodeURIComponent('‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•Å‡§ù‡•á FoodPrint Marketplace ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è‡•§ | Hello! I need help with FoodPrint Marketplace.');
            window.open('https://wa.me/919876543210?text=' + message, '_blank');
        }

        // Show blockchain journey
        function showBlockchainInfo(hash) {
            const modal = document.getElementById('blockchainModal');
            modal.style.display = 'flex';
            
            // Speak blockchain info
            if (window.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance('‡§Ø‡§π ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§¨‡•ç‡§≤‡•â‡§ï‡§ö‡•á‡§® ‡§™‡§∞ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§π‡•à‡•§ This product is verified on blockchain.');
                window.speechSynthesis.speak(utterance);
            }
        }

        function closeBlockchainModal() {
            document.getElementById('blockchainModal').style.display = 'none';
        }

        // Open QR Scanner
        function openQRScanner() {
            const modal = document.getElementById('qrScannerModal');
            modal.style.display = 'flex';
            
            // Speak instructions
            if (window.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance('QR ‡§ï‡•ã‡§° ‡§ï‡•ã ‡§ï‡•à‡§Æ‡§∞‡•á ‡§ï‡•á ‡§∏‡§æ‡§Æ‡§®‡•á ‡§∞‡§ñ‡•á‡§Ç‡•§ Hold QR code in front of camera.');
                utterance.lang = 'hi-IN';
                window.speechSynthesis.speak(utterance);
            }

            // TODO: Initialize actual QR scanner with camera
            // For now, this is a placeholder
        }

        function closeQRScanner() {
            document.getElementById('qrScannerModal').style.display = 'none';
        }

        function scanQRCode() {
            openQRScanner();
        }

        // Close modals on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeBlockchainModal();
                closeQRScanner();
            }
        });

        // Close modals on background click
        document.getElementById('blockchainModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBlockchainModal();
            }
        });

        document.getElementById('qrScannerModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeQRScanner();
            }
        });

        // Load products from backend (TODO: Replace with actual API call)
        // This is a placeholder - in production, fetch from /app/buyer/products API
        console.log('Marketplace loaded with blockchain features');
    </script>

    <%- include('partials/footer') %>
</body>
</html>

